<template name="Case">
    {{> PageNav}}
    {{#if Template.subscriptionsReady}}
        <h1 class="page-title">{{case.title}}</h1>
        <article class="case">
            <h3>{{_ "CASE_DETAILS"}}</h3>
            <p>{{case.content}}</p>
            <p><i class="fa fa-user"></i> {{findUsername(case.createdBy)}}</p>
            <p>
                <i class="fa fa-users"></i> {{{lawyers}}}
            </p>
            <p id="case-info-btn">
                {{#if isOwner case}}
                    {{#if isPrivate case}}
                        <button class="btn btn-text" id="public-case">{{_ "CASE_SETPUB"}}</button>
                    {{else}}
                        <button class="btn btn-text" id="private-case">{{_ "CASE_SETPRIV"}}</button>
                    {{/if}}
                {{/if}}
                {{#if isLawyer}}
                        {{#if hasGrab}}
                            <button class="btn btn-deny" id="drop-case">{{_ "CASE_DROPCASE"}}</button>
                        {{else}}
                            <button class="btn btn-primary" id="grab-case">{{_ "CASE_GRABCASE"}}</button>
                        {{/if}}
                {{/if}}
            </p>
        </article>
        {{#if contracts}}
            <article class="case">
                <h3>{{_ "CASE_CONTRACTS"}}</h3>
                <ul>
                    {{#each contracts}}
                        <li>
                            <span>{{getLawyerName(contractor)}}</span>
                            <a href="/contracts/{{_id}}">{{_ "CASE_CONTRACT_DETAILS"}}</a>
                        </li>
                    {{/each}}
                </ul>
            </article>
        {{else}}
            <article class="case">
                <h3>{{_ "CASE_NOCONTRACT"}}</h3>
                <p>{{_ "CASE_NOCONTRACT_INFO"}}</p>
            </article>
        {{/if}}
    {{else}}
        <p>{{_ "LOADING"}}</p>
    {{/if}}
    <br>
    <section class="blog">
    {{#each blog in blogs}}
        {{#if isAuthor blog}}
            <section class="blog-right">
                <h3>Test Right</h3>
                <p>{{blog.content}}</p>
            </section>
        {{else}}
            <section class="blog-left">
                <h3>Test Left</h3>
                <p>{{blog.content}}</p>
            </section>
        {{/if}}
    {{/each}}
    </section>
    <br>
    {{> NewCaseBlog}}
</template>

<template name="NewCaseBlog">
    <section class="new-case-container">
        {{#autoForm collection="CasesBlogs" id="insertCaseBlogForm" type="insert"}}
            <section>
                <h3>{{_ "CASE_BLOG_POST"}}</h3>
                {{> afQuickField name='caseId' value=caseId}}
                {{> afQuickField name='content' rows=3}}
                {{> afQuickField name='createdBy.authorId' value=userId}}
                {{#if isLawyer}}
                    {{> afQuickField name='createdBy.role' value='lawyer'}}
                {{else}}
                    {{> afQuickField name='createdBy.role' value='user'}}
                {{/if}}
            </section>
            <button type="submit" class="btn">{{_ "CASE_BLOG_SUBMIT"}}</button>
        {{/autoForm}}
    </section>
</template>