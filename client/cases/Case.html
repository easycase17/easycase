<template name="Case">
    {{> PageNav}}
    {{#if Template.subscriptionsReady}}
        <h1 class="page-title">{{case.title}}</h1>
        <article class="case">
            <h3>Details</h3>
            <p>{{case.content}}</p>
            <p><i class="fa fa-user"></i> {{findUsername(case.createdBy)}}</p>
            <p>
                <i class="fa fa-users"></i> {{{lawyers}}}
            </p>
            <p id="case-info-btn">
                {{#if isOwner case}}
                    {{#if isPrivate case}}
                        <button class="btn btn-text" id="public-case">Set Public</button>
                    {{else}}
                        <button class="btn btn-text" id="private-case">Set Private</button>
                    {{/if}}
                {{/if}}
                {{#if isLawyer}}
                        {{#if hasGrab}}
                            <button class="btn btn-deny" id="drop-case">Drop</button>
                        {{else}}
                            <button class="btn btn-primary" id="grab-case">Grab</button>
                        {{/if}}
                {{/if}}
            </p>
        </article>
        {{#if contracts}}
            <article class="case">
                <h3>Contracts</h3>
                <ul>
                    {{#each contracts}}
                        <li>
                            <span>{{getLawyerName(contractor)}}</span>
                            <a href="/contracts/{{_id}}">Details</a>
                        </li>
                    {{/each}}
                </ul>
            </article>
        {{else}}
            <article class="case">
                <h3>No Contract</h3>
                <p>There will be a lawyer assigned to this case. Please be patient, thank you.</p>
            </article>
        {{/if}}
    {{else}}
        <p>Loading ... </p>
    {{/if}}
    <br>
    <section class="blog">
    {{#each blog in blogs}}
        {{#if isAuthor blog}}
            <section class="blog-right">
                <h3>Test Right</h3>
                <p>{{blog.content}}</p>
            </section>
        {{else}}
            <section class="blog-left">
                <h3>Test Left</h3>
                <p>{{blog.content}}</p>
            </section>
        {{/if}}
    {{/each}}
    </section>
    <br>
    {{> NewCaseBlog}}
</template>

<template name="NewCaseBlog">
    <div class="new-case-container">
        {{#autoForm collection="CasesBlogs" id="insertCaseBlogForm" type="insert"}}
            <div>
                <h3>Add a Blog</h3>
                {{> afQuickField name='caseId' value=caseId}}
                {{> afQuickField name='content' rows=6}}
                {{> afQuickField name='createdBy.authorId' value=userId}}
                {{#if isLawyer}}
                    {{> afQuickField name='createdBy.role' value='lawyer'}}
                {{else}}
                    {{> afQuickField name='createdBy.role' value='user'}}
                {{/if}}
            </div>
            <button type="submit" class="btn btn-primary">Insert</button>
        {{/autoForm}}
    </div>
</template>